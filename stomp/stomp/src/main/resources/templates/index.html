<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>STOMP TEST</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

    <style>
        #logBox {
            width: 600px;
            height: 250px;
            border: 1px solid #444;
            padding: 10px;
            overflow-y: auto;
            margin-top: 15px;
            font-family: Consolas, monospace;
            background: #f7f7f7;
        }
        .ok { color: green; }
        .err { color: red; }
    </style>
</head>
<body>

<h2>WebSocket + STOMP Simple Test</h2>

<button onclick="connect()">CONNECT</button>
<button onclick="sendMsg()">SEND</button>

<div id="logBox"></div>

<script>
    let stompClient = null;

    const logBox = document.getElementById("logBox");

    function log(msg, type = "ok") {
        const p = document.createElement("p");
        p.className = type;
        p.innerText = msg;
        logBox.appendChild(p);
        logBox.scrollTop = logBox.scrollHeight;
    }

    function connect() {
        log("ğŸ”Œ CONNECT ì‹œë„ ì¤‘...", "ok");

        const socket = new SockJS("http://localhost:8080/ws/chat");
        // ì›¹ ì†Œì¼“ìœ„ì— ìŠ¤í†°í”„ í”„ë¡œí† ì½œì„ ì–¹ì–´ì„œ ì‚¬ìš©í•˜ë¼
        stompClient = Stomp.over(socket);

        stompClient.connect(
            {
                // Authorization: "Bearer xxxxxx"
            },
            (frame) => {
                console.log("CONNECTED âœ”", frame);
                log("ğŸŸ¢ CONNECTED ì„±ê³µ!", "ok");

                stompClient.subscribe("/sub/chat/room/1", (msg) => {
                    log("ğŸ“© ë©”ì‹œì§€ ìˆ˜ì‹ : " + msg.body, "ok");
                });
            },
            (error) => {
                console.log("ì—°ê²° ì‹¤íŒ¨ âŒ", error);
                log("ğŸ”´ CONNECT ì‹¤íŒ¨: " + error, "err");
            }
        );
    }

    function sendMsg() {
        if (!stompClient) {
            log("âš ï¸ ë¨¼ì € CONNECT í•´!", "err");
            return;
        }

        const body = {
            roomId: 1,
            content: "í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€!",
        };

        stompClient.send("/pub/chat/message", {}, JSON.stringify(body));

        log("ğŸ“¤ SEND ì™„ë£Œ â†’ /pub/chat/message", "ok");
    }
</script>

</body>
</html>
